<html>

<head>
  <meta charset="UTF-8">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <title>Project 2 Final</title>

  <style>
    .center {
      text-align: center;
      color: rgb(84, 82, 82);
    }
  </style>
</head>

<body>
  <h1>Project 2</h1>
  <h2>Seonghee Lee (sl994), Christy Song (cs966), Lydia Kim (lmk225), Sandy Jiang (sj458)</h2>

  <div class="center">
    <h3>1. General Exploration with Topography Map</h3>
    <p>i. The topography map can show different shades of a particular color for
      each country to represent their happiness ranking from the dataset. <br>
      ii. When a specific country is hovered over or selected, it can be outlined
      and we can provide information on their GDP and other information such as the MBTI distributions (e.g. distributed
      bar graph, horizontal bar graphs, ).</p>

    <strong>Visualization 1: General Exploration with Topography Map</strong><br>
    <svg id="choropleth" height="800" width="800" style="margin:20px; border:1px solid lightgrey"></svg>

    <h3>2. GDP of Countries sorted by MBTI</h3>
    <p>i. The bar graph would show the gdp distribution by country <br>
      ii. When the user clicks on a MBTI character, bar graphs are resorted by country with the largest distribution of
      that mbti to the least <br>
      iii. When the user hovers over each of the graph points (countries), a tooltip shows the distribution of the MBTI
      of
      that country. <br>
      iv. MBTI Characters</p>
    <strong>Visualization 2: GDP of Countries by each MBTI distribution</strong><br>
    <svg id='viz2' width="900" height="600" style="margin:20px; border:1px solid lightgrey"></svg>

    <script>
      const svg1 = d3.select("#choropleth");
      const width1 = svg1.attr("width");
      const height1 = svg1.attr("height");
      const margin1 = { top: 20, right: 20, bottom: 20, left: 20 };
      const mapWidth1 = width1 - margin1.left - margin1.right;
      const mapHeight1 = height1 - margin1.top - margin1.bottom;
      const map1 = svg1.append("g")
        .attr("transform", "translate(" + margin1.left + "," + margin1.top + ")");

      const svg2 = d3.select("svg#viz2");
      const width2 = svg2.attr("width");
      const height2 = svg2.attr("height");
      const margin2 = { top: 5, right: 5, bottom: 20, left: 20 };
      const chartWidth2 = width2 - margin2.right;
      const chartHeight2 = height2 - margin2.bottom;
      const chartArea2 = svg2.append("g")
        .attr("transform", `translate(${margin2.left}, ${margin2.top})`);

      const requestData = async function () {
        // load all data
        const happiness_data = await d3.csv("./world_happiness.csv");
        const mbti_data = await d3.csv('./mbti_countries.csv');
        const gdp_data = await d3.csv('./gdp_countries.csv');
        console.log(happiness_data);
        console.log(mbti_data);
        console.log(gdp_data);

        // mbti_data: convert distribution to numbers & add -A and -T of same type
        mbti_data.forEach((d, i) => {
          mbti_keys = ['ENFJ', 'ENFP', 'ENTJ', 'ENTP', 'ESFJ', 'ESFP', 'ESTJ', 'ESTP', 'INFJ', 'INFP', 'INTJ', 'INTP', 'ISFJ', 'ISFP', 'ISTJ', 'ISTP'];
          mbti_keys.forEach((mbti, mbti_i) => {
            d[mbti + '-A'] = Number(d[mbti + '-A']);
            d[mbti + '-T'] = Number(d[mbti + '-T']);
            d[mbti] = d[mbti + '-A'] + d[mbti + '-T'];
          });
        });
        console.log(mbti_data);

        // gdp_data: convert gdp to number
        gdp_data.forEach((d, i) => {
          d['GDP ($ per capita)'] = Number(d['GDP ($ per capita)']);
        });
        console.log(gdp_data);

        // viz2
        const mbtiCountriesNum = Object.keys(mbti_data).length;
        console.log(mbtiCountriesNum);

        // var zips = topojson.feature(nyincome, nyincome.objects.zip_codes);
        // var zipsMesh = topojson.mesh(nyincome, nyincome.objects.zip_codes);
        // var stateMesh = topojson.mesh(nyincome, nyincome.objects.state);
        // var projection = d3.geoMercator().fitSize([mapWidth, mapHeight], zips);
        // var path = d3.geoPath().projection(projection);

        // const allvalues = d3.map(nyincome.objects.zip_codes.geometries, d => d.properties.median_income)
        // const colorRange = ["054A91", "#3E7CB1", "#81A4CD","#C2FFFB", "#DBE4EE"];
        // const colorScale = d3.scaleQuantile()
        //   .domain(allvalues)
        //   .range(colorRange);

        // map.selectAll("path.zip").data(zips.features)
        //   .join("path")
        //   .attr("class", "zip")
        //   .attr("note", d => d.id)
        //   .attr("d", path)
        //   .style("fill", d => colorScale(d.properties.median_income));

        // map.append("path").datum(zipsMesh)
        //   .attr("class", "outline_zips")
        //   .attr("d", path);

        // map.append("path").datum(stateMesh)
        //   .attr("class", "outline_state")
        //   .attr("d", path);
      }
      requestData();
    </script>
    </p>
</body>
</div>

</html>